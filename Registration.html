<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025 ISPH Join Meeting｜報名登記</title>
  <meta name="description" content="ISPH 2025 年會報名表（已串接 Google Forms）" />
  <style>
    :root{ --primary:#2563eb; --primary-600:#1d4ed8; --bg:#f8fafc; --text:#111827; --muted:#6b7280; --card:#ffffff; --ring:rgba(37,99,235,.25); --danger:#dc2626; --success:#16a34a; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans","PingFang TC","Microsoft JhengHei",sans-serif;color:var(--text);background:var(--bg)}

    /* Nav */
    .nav{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid #e5e7eb}
    .nav .wrap{max-width:1100px;margin:auto;display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
    .brand img{width:40px;height:40px;object-fit:contain}
    .brand .title{font-weight:700;letter-spacing:.2px}
    .nav-links{display:flex;gap:18px}
    .nav-links a{color:#374151;text-decoration:none;font-size:15px;padding:8px 10px;border-radius:8px}
    .nav-links a:hover{background:#f3f4f6}
    .nav-cta{margin-left:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid #d1d5db;border-radius:12px;background:#fff;color:var(--text);cursor:pointer;text-decoration:none}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.primary:hover{background:var(--primary-600)}
    .hamburger{display:none;background:none;border:0;padding:8px;border-radius:8px}
    .hamburger span{display:block;width:22px;height:2px;background:#111;margin:5px 0;border-radius:2px}
    @media (max-width:900px){
      .nav-links{display:none;position:absolute;left:0;right:0;top:60px;background:#fff;border-bottom:1px solid #e5e7eb;flex-direction:column;padding:10px}
      .nav-links.open{display:flex}
      .nav-cta{display:none}
      .hamburger{display:block}
    }

    /* Hero */
    .hero{background:linear-gradient(180deg,#fff,#eef2ff);border-bottom:1px solid #e5e7eb}
    .container{max-width:1100px;margin:auto;padding:24px 16px}
    .hero h1{font-size:clamp(24px,3.5vw,40px);margin:6px 0 10px}
    .hero p{color:var(--muted);margin:0}

    /* Cards */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:22px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .card .hd{padding:14px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
    .card .bd{padding:16px}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:14px;color:#374151;margin-bottom:6px}
    input[type="text"],input[type="email"],input[type="tel"],select,textarea{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:12px;background:#fff;font-size:15px}
    input[type="number"]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:12px;background:#fff;font-size:15px}
    textarea{min-height:90px}

    .fee-grid{display:grid;grid-template-columns:2fr 1fr;gap:10px;align-items:end}
    .muted{color:var(--muted);font-size:13px}

    .total{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border:1px dashed #c7d2fe;border-radius:14px;background:#eef2ff;margin-top:10px}
    .total .amt{font-size:22px;font-weight:800}

    .success{display:none;margin-top:12px;padding:12px 14px;border-radius:12px;background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46}
    .footer{margin-top:28px;font-size:13px;color:#6b7280}
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="nav" aria-label="主選單">
    <div class="wrap">
      <a class="brand" href="#">
        <img src="LOGO.PNG" alt="ISPH Logo" />
        <span class="title">International Society for Precision Health</span>
      </a>
      <div class="nav-links" id="navLinks">
        <a href="#fees">費用</a>
        <a href="#register">報名</a>
        <a href="Join us.html">Join ISPH</a>
        <a href="Annual2025.html">Home</a>
      </div>
      <div class="nav-cta">
        <a class="btn primary" href="#register">立即報名</a>
      </div>
      <button class="hamburger" id="hamburger" aria-label="開啟選單" aria-expanded="false" aria-controls="navLinks">
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero">
    <div class="container">
      <p class="muted">Registration</p>
      <h1>2025 ISPH Join Meeting｜台灣與會者報名</h1>
      <p>活動日期：2025/10/18（六）｜</p>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Fees & add-ons (no early-bird) -->
      <section class="card" id="fees">
        <div class="hd">費用與加購（無早鳥）</div>
        <div class="bd">
          <div class="fee-grid">
            <div>
              <label for="status">身份選擇</label>
            </div>
            <div>
              <select id="status" aria-label="選擇身份">
                <!-- 顯示 4,800/8,000 供使用者理解；實際提交的下拉在表單區 -->
                <option value="member">一般會員 (NT$ 4,800)</option>
                <option value="student">學生 (NT$ 4,800)</option>
                <option value="nonmember">非會員 (NT$ 8,000)</option>
              </select>
            </div>
          </div>

          <div class="fee-grid" style="margin-top:12px">
            <div>
              <label>同行人員 <span class="muted">（每位 NT$ 3,300）</span></label>
            </div>
            <div>
              <!-- 這裡不送出，只做即時計算與同步 -->
              <input type="number" id="qtyCompanion" min="0" value="0" aria-label="同行人員數量" />
            </div>
          </div>

          <div class="fee-grid" style="margin-top:12px">
            <div>
              <label>大會晚宴 <span class="muted">（每位 NT$ 3,300）</span></label>
            </div>
            <div>
              <input type="number" id="qtyBanquet" min="0" value="0" aria-label="大會晚宴數量" />
            </div>
          </div>

          <div class="fee-grid" style="margin-top:12px">
            <div>
              <label>大會旅遊 <span class="muted">（每位 NT$ 2,500）</span></label>
            </div>
            <div>
              <input type="number" id="qtyTour" min="0" value="0" aria-label="大會旅遊數量" />
            </div>
          </div>

          <div class="total" aria-live="polite" style="margin-top:16px">
            <div>
              <div>應繳金額</div>
              <div class="muted">依上述數量及身份自動更新</div>
            </div>
            <div class="amt" id="amount">NT$ 4,800</div>
          </div>
        </div>
      </section>

      <!-- Registration form (Google Forms) -->
      <section class="card" id="register">
        <div class="hd">線上報名表</div>
        <div class="bd">
          <form id="regForm" action="https://docs.google.com/forms/u/0/d/18XOa_hiewNKFeFX1yKZDhPn6h0-zMSLjOUh7qpwmgYo/formResponse" method="POST" target="hidden_iframe" novalidate>
            <div id="okMsg" class="success">✅ 報名已送出！我們已收到您的資料，確認信將寄至您的 Email。</div>

            <div class="row">
              <div>
                <label>姓名/first name+family name<span style="color: red;">(請填中英文名)</span><span style="color:red">*</span></label>
                <input type="text" name="entry.1195663187" required placeholder="王小明 / Xiao‑Ming Wang" />
              </div>
              <div>
                <label>E-mail <span style="color:red">*</span></label>
                <input type="email" name="entry.1329980034" required placeholder="you@gmail.com" />
                <input type="hidden" id="emailAddressHidden" name="emailAddress" value="" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>聯絡電話 <span style="color:red">*</span></label>
                <input type="tel" name="entry.1504094709" required placeholder="09xx-xxx-xxx" />
              </div>
              <div>
                <label>職稱＋服務/就讀單位 (<span style="color: red;">請填英文)</span></label>
                <input type="text" name="entry.1165126282" placeholder="Dr. + XX University" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>身分別 <span style="color:red">*</span></label>
                <!-- 修正：確保所有選項都顯示 -->
                <select id="formStatus" name="entry.573453040" required>
                  <option value="">請選擇</option>
                  <option value="一般會員（NT$ 4,800）">一般會員（NT$ 4,800）</option>
                  <option value="學生（NT$ 4,800）">學生（NT$ 4,800）</option>
                  <option value="非會員（NT$ 8,000）">非會員（NT$ 8,000）</option>
                </select>
              </div>
              <div>
                <label>餐食需求 <span style="color:red">*</span></label>
                <select name="entry.78350209" required>
                  <option value="葷食">葷食</option>
                  <option value="素食">素食</option>
                  <option value="特殊過敏（請於備註欄說明）">特殊過敏（請於備註欄說明）</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div>
                <label>是否需要發票/收據 <span style="color:red">*</span></label>
                <select name="entry.1845447127" required>
                  <option value="不需要">不需要</option>
                  <option value="收據（個人）">收據（個人）</option>
                  <option value="發票（公司/三聯式）">發票（公司/三聯式）</option>
                </select>
              </div>
              <div>
                <label>付款方式 <span style="color:red">*</span></label>
                <select name="entry.1154667495" required>
                  <option value="銀行轉帳">銀行轉帳</option>
                  <option value="現場繳費">現場繳費</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div>
                <label>收據抬頭</label>
                <input type="text" name="entry.179378040" placeholder="○○股份有限公司 / 張三" />
              </div>
              <div>
                <label>統一編號（公司發票）</label>
                <input type="text" name="entry.984856977" placeholder="12345678" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>寄送地址</label>
                <input type="text" name="entry.1261185884" placeholder="收據/發票寄送地址" />
              </div>
              <div>
                <label>備註</label>
                <input type="text" name="entry.749605536" placeholder="若有過敏原，請註明" />
              </div>
            </div>

            <!-- 加購數量（表單送出用；上方費用區只做顯示+同步） -->
            <div class="row">
              <div>
                <label>同行人員數量</label>
                <input type="number" id="postCompanion" name="entry.2073761257" min="0" value="0" />
              </div>
              <div>
                <label>大會晚宴數量</label>
                <input type="number" id="postBanquet" name="entry.566557431" min="0" value="0" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>大會旅遊數量</label>
                <input type="number" id="postTour" name="entry.932349988" min="0" value="0" />
              </div>
              <div>
                <label>總金額（系統自動計算，僅顯示）</label>
                <input type="text" id="postTotal" readonly />
              </div>
            </div>

            <div class="row">
              <div>
                <label>個資同意 <span style="color:red">*</span></label>
                <label style="display:flex;gap:8px;align-items:center">
                  <input type="checkbox" id="gdpr" name="entry.979619625" value="我同意本會為活動聯繫與保險用途使用聯絡資訊" required />
                  <span>我同意本會為活動聯繫用途使用聯絡資訊</span>
                </label>
              </div>
            </div>

            <div class="total" aria-live="polite">
              <div>
                <div>應繳金額</div>
                <div class="muted">送出後將寄繳費資訊至您的 Email</div>
              </div>
              <div class="amt" id="amountBottom">NT$ 4,800</div>
            </div>

            <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
              <button type="submit" class="btn primary">送出報名</button>
              <button type="reset" class="btn" id="resetBtn">清除</button>
            </div>
          </form>
          <iframe name="hidden_iframe" id="hidden_iframe" style="display:none"></iframe>
        </div>
      </section>

      <section class="card" id="faq" style="margin-top:22px">
        <div class="hd">注意事項</div>
        <div class="bd">
          <ol class="muted">
            <li>報名完成後，系統將寄發確認信至您的電子郵件。</li>
            <li>繳費資訊：完成線上表單後請於<span style="color: red;">3</span>日內轉帳（帳戶資訊：彰化銀行北台中分行 (009) 4004 51 48739 300 戶名：王進崑）。</li>
            <li>退費規定：活動 14 天前（含）申請全額退費（須扣手續費）；活動 7–13 天退 50%；活動 6 天內恕不退費，可更換參加者。</li>
            <li>收據：活動當天給予臨時收據，若須正式收據請當場登記，結束後 30 個工作日內寄出。</li>
          </ol>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ===== 手機漢堡 =====
    (function(){
      const btn = document.getElementById('hamburger');
      const nav = document.getElementById('navLinks');
      btn?.addEventListener('click', ()=>{
        const open = nav.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();

    // ===== 計費邏輯（無早鳥） =====
    const FEES = { companion: 3300, banquet: 3300, tour: 2500 };
    const fmt = (n) => `NT$ ${n.toLocaleString('zh-TW')}`;

    const statusSelect = document.getElementById('status');
    const formStatus = document.getElementById('formStatus');
    const qtyCompanion = document.getElementById('qtyCompanion');
    const qtyBanquet = document.getElementById('qtyBanquet');
    const qtyTour = document.getElementById('qtyTour');
    const postCompanion = document.getElementById('postCompanion');
    const postBanquet = document.getElementById('postBanquet');
    const postTour = document.getElementById('postTour');
    const amountTop = document.getElementById('amount');
    const amountBottom = document.getElementById('amountBottom');
    const postTotal = document.getElementById('postTotal');

    function getNum(el){ return Math.max(0, parseInt(el?.value || '0', 10) || 0); }

    function calc(){
      const status = statusSelect?.value || 'member';
      const baseFee = (status === 'nonmember') ? 8000 : 4800; // 顯示與計算
      const c = getNum(qtyCompanion);
      const b = getNum(qtyBanquet);
      const t = getNum(qtyTour);
      const total = baseFee + c*FEES.companion + b*FEES.banquet + t*FEES.tour;
      if (amountTop) amountTop.textContent = fmt(total);
      if (amountBottom) amountBottom.textContent = fmt(total);
      if (postTotal) postTotal.value = total;
      // 同步數量到實際送出的表單欄位
      if (postCompanion) postCompanion.value = c;
      if (postBanquet) postBanquet.value = b;
      if (postTour) postTour.value = t;
      
      // 修正：同步身分別到表單，確保所有選項都能正確對應
      if (formStatus){
        const statusMap = {
          'member': '一般會員（NT$ 4,800）',
          'student': '學生（NT$ 4,800）',
          'nonmember': '非會員（NT$ 8,000）'
        };
        const targetValue = statusMap[status];
        if (targetValue) {
          formStatus.value = targetValue;
        }
      }
    }

    // 從表單改回費用區（若使用者改了下拉）
    function syncFromForm(){
      if (!formStatus || !statusSelect) return;
      const reverseMap = {
        '一般會員（NT$ 4,800）': 'member',
        '學生（NT$ 4,800）': 'student',
        '非會員（NT$ 8,000）': 'nonmember'
      };
      const newStatus = reverseMap[formStatus.value];
      if (newStatus) {
        statusSelect.value = newStatus;
        calc();
      }
    }

    [statusSelect, qtyCompanion, qtyBanquet, qtyTour].forEach(el=>{
      el?.addEventListener('input', calc);
      el?.addEventListener('change', calc);
    });
    formStatus?.addEventListener('change', syncFromForm);

    calc();

    // ===== Google Forms 送出：hidden iframe 成功提示 + 同步 emailAddress =====
    const regForm = document.getElementById('regForm');
    const okMsg = document.getElementById('okMsg');
    const resetBtn = document.getElementById('resetBtn');
    const emailInput = regForm?.querySelector('input[name="entry.1329980034"]');
    const emailHidden = document.getElementById('emailAddressHidden');
    let submitted = false;

    regForm.addEventListener('submit', (e)=>{
      if (!regForm.reportValidity()){ e.preventDefault(); return; }
      if (emailHidden && emailInput){ emailHidden.value = emailInput.value || ''; }
      submitted = true;
      if (okMsg){ okMsg.style.display='block'; okMsg.textContent='⌛ 傳送中… 請稍候'; }
    });

    document.getElementById('hidden_iframe').addEventListener('load', ()=>{
      if (!submitted) return;
      if (okMsg){ okMsg.style.display='block'; okMsg.textContent='✅ 報名已送出！我們已收到您的資料，確認信將寄至您的 Email。'; }
      regForm.reset();
      // 重置顯示區的數量與身份
      ['qtyCompanion','qtyBanquet','qtyTour'].forEach(id=>{
        const el = document.getElementById(id); if (el) el.value = 0;
      });
      if (statusSelect) statusSelect.value = 'member';
      calc();
      submitted = false;
    });

    resetBtn?.addEventListener('click', ()=>{ setTimeout(calc,0); });
  </script>
</body>
</html>
